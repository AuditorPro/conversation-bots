# Разговорные чат-боты для общения в Telegram и Вконтакте с использованием DialogFlow
### Автор проекта: Алексей Свирин, телеграм — [@svirin](https://telegram.me/svirin)
### Цель проекта: создание автономных чат-ботов для мессенджера Телеграм и социальной сети ВКонтакте

Боты отвечают пользователю на сообщения, боты работают на одной бозе фраз, которая загружена в DialogFlow. Ботов можно быстро обучить благодаря дополнительно реализованным функциям. Также в ботах реализована отправка сообщений на отдельного бота в телеграме для ошибок.

Боты, с которыми можно поговорить:
1) Телеграм. Для старта необходимо ввести команду /start
2) [ВКонтакте](https://vk.com/public183166802). Бот отвечает на личные сообщения данной группы

![](working_bot.gif)

# Как установить
### Этап 1.1 Для запуска бота в Телеграме необходимо:
1) Создать бота для пользователй в telegram через [Отца ботов](https://telegram.me/BotFather) и взять токен для авторизации.
2) Создать бота для сервисных сообщений в telegram через [Отца ботов](https://telegram.me/BotFather) и взять токен для авторизации.
3) Узнать свой ID через [специального бота](https://telegram.me/userinfobot).

### Этап 1.2 Для запуска бота во Вконтакте необходимо:
1) Создать бота для сервисных сообщений в telegram через [Отца ботов](https://telegram.me/BotFather) и взять токен для авторизации.
2) Узнать свой ID через [специального бота](https://telegram.me/userinfobot).
3) Создать сообщество по ссылке
4) Взять сервисный ключ
5) Разрешить отправку сообщений

### Этап 1.3 Зарегистрироваться и получить ключ авторизации для Dialogflow:
1) Зарегистрироваться на [сайте](https://dialogflow.com/) сервиса.
2) Создать нового агента (нашего бота)
3) На вкладке General установить настройку V2 API и перейти по ссылке в поле 'Service Account' в единую панель управления сервисами Google для получения авторизационного ключа.
4) У вашего сервисного аккаунта необходимо создать ключ и скачать его. Этот ключ авторизации необходимо будет использовать для получения ответов от Dialogflow. 
5) На вкладке IAM у вашего сервисного аккаунта установить роль 'Администратор Dialogflow API'

### Этап 2. Установить переменные окружения
1) telegram_token: токен для основного телеграм-бота;  
2) telegram_token_information_message: токен для сервисного телеграм-бота;
3) chat_id_information_message: id пользователя телеграм, который будет получать сервисные сообщения;  
4) vk_community_token: токен для бота ВКонтакте;
5) project_id: id проекта в dialogflow, который можно взять вкладке 'General' в поле 'Project ID';
6) GOOGLE_APPLICATION_CREDENTIALS: путь для json-файла с ключом авторизации для dialogflow;
7) GOOGLE_CREDENTIALS: данную переменную необходимо использовать только, если вы используете Heroku. В данную переменную необходимо поместить содержимое json-файла авторизации для dialogflow.

### Этап 3. Запустить бота. Пример запуска
```python
python3 main.py
```

# Требования
Все требуемые модули указаны в файле requirements.txt  
Для установки запустите команду:
```python
python3 pip install -r requirements.txt
```

# Требования к запуску на Heroku
Для запуска на Heroku необходимы файлы Procfile и Pipfile:
1) В файле Procfile прописано какой файл нужно запускать на Heroku.
2) В файлах Pipfile и reqirements.txt указаны необходимые модули для работы бота.
